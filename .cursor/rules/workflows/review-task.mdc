---
description: Workflow for review a specific task implementation from a product increment following the systematic review workflow
globs: 
alwaysApply: false
---
# Review Task Workflow

PRD file: $1
Product Increment file: $2
Task being reviewed: $3
Engineer's request file: $4
Engineer's response file: $5
Context update: $6

## Review Efficiency

**If this is your first review**: Read PRD file, Product Increment file, and all applicable rules.

**If you have context update ($6)**: The tech lead has provided file references to read for catching up efficiently. Read the specified files instead of re-reading everything.

## Multiple Request Handling

**If you see multiple request files when starting**:
1. **Read ALL request files** in chronological order (0001, 0002, 0003...)
2. **Understand the sequence** - Later requests might modify or clarify earlier ones
3. **Review based on the FINAL/LATEST request** - This supersedes earlier requests
4. **Create ONE response file** for the latest request only
5. **Don't respond to superseded requests** - Only the final request matters

## Mandatory Review Workflow

**This workflow is MANDATORY** - Follow every step exactly.

**Step 0. Create todo list**:
   - Create a todo list with all workflow steps using the template below
   - Use `git status --porcelain` to find ALL changed files
   - Add a subtask for EACH changed file under STEP 4
   - Set all tasks to [pending]

**Step 1. Understand context and catch up efficiently**:
   - Mark "Understand context and catch up efficiently" [in_progress] in todo
   - **If context update provided ($6)**: Follow the specific instructions in $6 to catch up efficiently
   - **If no context update**: Read PRD file ($1), Product Increment file ($2), request file ($4), response file ($5)
   - Mark "Understand context and catch up efficiently" [completed] in todo

**Step 2. Validate implementation builds by running check command**:
   - Mark "Validate implementation builds by running check command" [in_progress] in todo
   - **Backend**: Run `pp check` and verify exit code 0
   - **Frontend**: Run `pp check --frontend` and verify exit code 0
   - **E2E**: Run `pp e2e` and verify exit code 0
   - Always check `/application/result.json` for any static code analysis findings
   - Mark "Validate implementation builds by running check command" [completed] in todo

**Step 3. Study rules**:
   - Mark "Study rules" [in_progress] in todo
   - **If context update says "rules already studied"**: Skip this step
   - **If first time or context update says "read rules"**: Read ALL files in appropriate rules directory
   - **Backend**: /.cursor/rules/backend/, **Frontend**: /.cursor/rules/frontend/, **E2E**: /.cursor/rules/end-to-end-tests/
   - Mark "Study rules" [completed] in todo

**Step 4. Review each changed file in detail**:
   - Mark "Review each changed file in detail" [in_progress] in todo
   - For each changed file (from git status):
     - Mark "Review [filename] and ensure all lines, methods, properties, classes follow ALL rules" [in_progress] in todo
     - Read the entire file line by line
     - Compare EVERY line, method, property, class against ALL applicable rules
     - Document any violations with specific rule citations and line numbers
     - Mark "Review [filename] and ensure all lines, methods, properties, classes follow ALL rules" [completed] in todo
   - Mark "Review each changed file in detail" [completed] in todo

**Step 5. Review high level architecture**:
   - Mark "Review high level architecture" [in_progress] in todo
   - Make a very high level review of the overall implementation
   - Check architectural patterns, feature organization, and design consistency
   - Mark "Review high level architecture" [completed] in todo

**Step 6. Make binary decision (approve or reject)**:
   - Mark "Make binary decision (approve or reject)" [in_progress] in todo
   - **APPROVED**: Zero findings or only minor suggestions that don't affect functionality
   - **NOT APPROVED**: Any findings that must be fixed
   - Mark "Make binary decision (approve or reject)" [completed] in todo

**Step 7. If approved, commit changes**:
   - Mark "If approved, commit changes" [in_progress] in todo
   - **If APPROVED**: Use SlashCommand tool to run `/commit-changes` with descriptive commit message
   - **If NOT APPROVED**: Skip this step
   - Mark "If approved, commit changes" [completed] in todo

**Step 8. Update Product Increment status**:
   - Mark "Update Product Increment status" [in_progress] in todo
   - **If APPROVED**: Edit Product Increment file: change [Ready for Review] to [Completed]
   - **If NOT APPROVED**: Edit Product Increment file: change [Ready for Review] to [Changes Required]
   - Mark "Update Product Increment status" [completed] in todo

**Step 9. Create response file**:
   - Mark "Create response file" [in_progress] in todo
   - Create response file with clear "## DECISION: APPROVED" or "## DECISION: NOT APPROVED - REQUIRES FIXES"
   - List all findings if NOT APPROVED
   - **IMPORTANT**: Use descriptive response file names with proper casing for better activity display:
     * Format: `NNNN.{agent-type}.response.Title-Case-Review-Description.md`
     * Example: `0001.backend-reviewer.response.Review-Team-Aggregate-Found-3-Critical-Issues.md`
     * Use Title-Case-With-Dashes so the activity display shows "Review Team Aggregate Found 3 Critical Issues"
   - Use atomic rename: .tmp → .mdc to signal completion
   - Mark "Create response file" [completed] in todo

## Todo list template

Use this exact format:

```
Understand context and catch up efficiently [pending]                                                       (STEP 1)
Validate implementation builds by running "pp check" [pending]                                              (STEP 2)
Study rules relevant for the task at hand [pending]                                                         (STEP 3)
Review each changed file in detail [pending]                                                                (STEP 4) *
├─  Review [filename.ext] and ensure all lines, methods, properties, classes follow ALL rules [pending]
├─  Review [filename.ext] and ensure all lines, methods, properties, classes follow ALL rules [pending]
└─  Review [filename.ext] and ensure all lines, methods, properties, classes follow ALL rules [pending]
Review high level architecture (make a very high level review) [pending]                                   (STEP 5)
Make binary decision (approve or reject) [pending]                                                          (STEP 6)
If approved, commit changes [pending]                                                                       (STEP 7)
Update Product Increment status with [Completed] or [Changes Required] [pending]                            (STEP 8)
Create response file [pending]                                                                              (STEP 9)
```

**DO NOT CHANGE THE WORDING**:
- DO NOT write "Read and understand PRD and Product Increment requirements"
- DO NOT write "Analyze each implemented file against code quality standards"
- DO NOT write "Verify database migration and EF Core configuration"
- DO NOT write "Create comprehensive review response"
- COPY THE EXACT TEXT: "Understand context and catch up efficiently"
- COPY THE EXACT TEXT: "Study rules relevant for the task at hand"
- COPY THE EXACT TEXT: "Review [filename.ext] and ensure all lines, methods, properties, classes follow ALL rules"

**CRITICAL: Use these exact prefixes for proper visual hierarchy:**
- `├─` for file review items (not the last in their group)
- `└─` for the last file review item

## Quality Standards

If you have recommendations or suggestions, you CANNOT approve. Quality is the highest priority. Only approve when implementation is production-ready with zero required changes.
