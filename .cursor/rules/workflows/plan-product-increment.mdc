---
description: Workflow for plan technical tasks for a product increment based on a prd
globs: 
alwaysApply: false
---
# Plan Product Increment Workflow

PRD file and product increment number: $ARGUMENTS

Read the PRD file provided in the arguments above and focus on the specific product increment number mentioned. Your job is to create technical tasks for that specific product increment.

The goal is to create a `./.workspace/task-manager/yyyy-MM-dd-[prd-title]/[#-product-increment-title].md` file with low-level technical tasks and, when approved, create matching tasks in [PRODUCT_MANAGEMENT_TOOL]. The date prefix should match the PRD's directory date.

## Workflow

Follow the steps below to create and publish tasks.

1. Create product increment header and description

  - Create a product increment file `./.workspace/task-manager/yyyy-MM-dd-[prd-title]/[#-product-increment-title].md`, where the date prefix matches the PRD's directory date, and the `#` and `product-increment-title` is the same as used in the PRD's "Product increments" section.
  - At the top of each product increment file include:
    - **Level 1 header**: This should match the product increment title from the PRD.
    - **Purpose:**  a short description of what this product increment delivers and the features it contains.
    - **NOT included:** out-of-scope items.
    - **Dependencies:** previous product increments or external requirements.
    - **IMPORTANT:** warning not to work outside this scope.

2. Break product increment into tasks

   **CRITICAL: A task = one commit = one complete vertical slice**

   ### Vertical slice definition:
   
   **Backend vertical slice must include:**
   - Database changes (if needed)
   - Domain model/aggregate changes
   - A single command or query implementation  
   - API single endpoint
   - API tests
   - All in ONE task that results in ONE commit

   **Frontend vertical slice must include:**
   - Component creation
   - API integration (TanStack Query)
   - State management
   - User interactions
   - All in ONE task that results in ONE commit

   **WRONG approach (multiple tasks/commits):**
   - Task 1: Add database field ❌
   - Task 2: Update domain model ❌
   - Task 3: Create command ❌
   - Task 4: Add API endpoint ❌
   - Task 5: Write tests ❌

   **RIGHT approach (vertical slice):**
   - Task 1: Create complete GetTeam query with repository method, query handler, API endpoint, and tests ✅

   Since we prefer API tests, a commit with tests is a full vertical slice.

   ### Task guidelines:
   - The first task for a new feature is often larger (includes migration, aggregate, command, endpoint, tests)
   - Subsequent tasks can be smaller (e.g., just adding a query with its endpoint and tests)
   - Keep CRUD operations separate: Create in one task, Read in another, Update in another, Delete in another
   - Never have multiple commands or queries in one task
   - Never have mulitple API endpoints in one task
   - Prefix each task with a level-2 header followed by [Planned], for example `## 1 Create GetTeam query [Planned]`
   - Use "Sentence case" not "Title Case" for task headers

   > Note: Each task must result in code that compiles, runs, and can be tested independently

3. Add subtasks

   ### Precision without code lock-in:
   
   **BE PRECISE about:**
   - Class names, method names, property names
   - API endpoints and routes
   - Validation rules and business logic
   - Database schema and relationships
   - What guards and permissions to check
   
   **DON'T INCLUDE:**
   - Actual code syntax or snippets
   - Specific implementation details that might change
   - Technology-specific configurations
   - Detailed error messages
   
   **Good subtask example:**
   ```
   2.1 Create `UpdateTeam` command
     - Validate name length (≤ 50 Unicode chars)
     - Guard tenant Owner permission only
     - Check name uniqueness via repository
   ```
   
   **Bad subtask example (too much code detail):**
   ```
   2.1 Create UpdateTeam command
     - Add RuleFor(x => x.Name).Length(1, 50).WithMessage("...")
     - if (executionContext.UserInfo.Role != UserRole.Owner) return Result.Forbidden()
   ```

   ### Subtask guidelines:
   - For each task add small subtasks for each implementation step
   - Prefix each subtask with a number, for example `1.1 Create Team aggregate`
   - Focus on WHAT to implement, not HOW to code it
   - Let the implementation phase consult rules for exact patterns
   - Use `backticks` for names of classes, properties, file names
   - Avoid modifying `shared-kernel` or `shared-webapp` unless explicitly agreed

4. Review, approve and publish

   Save all product increment files under `./.workspace/task-manager/yyyy-MM-dd-[prd-title]/[#-product-increment-title].md` for user review.

5. Create product increment and tasks in [PRODUCT_MANAGEMENT_TOOL]

   After final approval, use the [PRODUCT_MANAGEMENT_TOOL] MCP tool to create one task for the product increment:
   - The task for the product increment must be linked to the parent backlog item for the PRD in [PRODUCT_MANAGEMENT_TOOL].
   - The description should include the full list of tasks and subtasks (copy the content of the file `./.workspace/task-manager/yyyy-MM-dd-[prd-title]/[#-increment-title].md`)

6. Tools available:

   - Perplexity MCP tool for research on complex implementation questions.
   - Context7 MCP tool for up-to-date best practices and technology updates.
   - Sequential thinking MCP tool to ensure tasks are ordered correctly.

## Example

Using these examples, to understand how to write tasks and subtasks for product increments:

- [Backend for team management](mdc:.cursor/rules/workflows/samples/1-backend-sample.mdc)
- [Frontend for team management](mdc:.cursor/rules/workflows/samples/2-frontend-sample.mdc)

## ✅ DO:

- Use the Sequential thinking MCP tool to order tasks correctly.
- Create one file per product increment under `./.workspace/task-manager/yyyy-MM-dd-[prd-title]/`.
- Keep tasks focused on the smallest vertical slices with API tests and one commit per task.
- Save files for review before approval.
- Use the [PRODUCT_MANAGEMENT_TOOL] MCP tool to publish tasks after approval.

## ❌ DON'T:

- Skip research – always read existing code and rules before writing tasks and subtasks.
- Combine multiple commands or queries into one task or combine frontend and backend tasks into one.
- Create separate tasks for tests. Test should be part of the task.
- Create tasks that cannot be tested in isolation (for example, a command without an API endpoint).
- Include implementation details that cannot be built or tested in one commit.
- Create tasks that depend on details that will be implemented later.
- Modify `shared-kernel` or `shared-webapp` without explicit agreement.
- Create or delete product increment files outside `./.workspace/task-manager/yyyy-MM-dd-[prd-title]/`.
- Write titles in Title Case. Instead always use sentence case.
